<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Network Monitoring 2. LibreNMS Agent Configuration - Seattle Community Network Docs Site</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Network Monitoring 2. LibreNMS Agent Configuration";
        var mkdocs_page_input_path = "infrastructure/librenms-setup.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Seattle Community Network Docs Site
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Faq</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/connection/">How do I get Internet?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/what/">What is a Community Network?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/why/">Why have a Community Network?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/about/">What is the Seattle Community Network?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/how/">How does SCN Work?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/site/">What is this site?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/help/">How can I Help?</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Community</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../community/join/">Join Us</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../community/mission-vision-values/">Mission, Vision, Values</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../community/code-of-conduct/">Code of Conduct</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../community/join/">Join Us</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../community/partners/">Our Partners</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../community/tech-help/">Community Tech Help</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../community/community-networking-toolkit/">Community Networking Toolkit</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Learn</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../learn/wireless-communication/">Wireless Communication</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../learn/cable-crimping/">Crimping Ethernet Cables</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../learn/lte-networks/">LTE Networks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../learn/networking/">Networking</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Infrastructure</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../hardware/">Hardware Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../software/">Software Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../peering/">Public ASN Peering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../librenms-manager-setup/">Network Monitoring 1. LibreNMS Network Manager Configuration</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Network Monitoring 2. LibreNMS Agent Configuration</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#adding-a-new-node-to-librenms">Adding a New Node to LibreNMS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#epc-snmp-configuration">ePC SNMP Configuration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#baicells-snmp-configuration">Baicells SNMP configuration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#adding-the-node-to-librenms">Adding the Node to LibreNMS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#other-helpful-notes">Other helpful notes:</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../epc-setup/">Step 1. LTE Core Network Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sas-setup/">Step 2. eNodeB and SAS Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../proxmox-vaultwarden-deployment/">Proxmox Deployment Guide - Vaultwarden</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Contribute</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../contribute/contribute/">Contribute to SCN Docs</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Seattle Community Network Docs Site</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Infrastructure</li>
      <li class="breadcrumb-item active">Network Monitoring 2. LibreNMS Agent Configuration</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="librenms-agent-configuration">LibreNMS Agent Configuration</h1>
<h2 id="adding-a-new-node-to-librenms">Adding a New Node to LibreNMS</h2>
<p>Both the eNodeB and the ePC must be configured individually in order for them to report statistics to the SNMP Manager. Since the eNodeB is not directly accessible from the management VPN, we configure an SNMP proxy on the ePC to pass SNMP statistics to the Management host.</p>
<h2 id="epc-snmp-configuration">ePC SNMP Configuration</h2>
<ul>
<li>
<p>Install snmpd to the ePC node:
<code>$ sudo apt install snmpd</code></p>
</li>
<li>
<p>Modify /etc/snmp/snmpd.conf:</p>
</li>
</ul>
<pre><code>sysLocation     &lt;SITE NAME STRING&gt;
sysContact      lcl@seattlecommunitynetwork.org
sysServices     72
master          agentx
agentAddress    udp:161
com2sec readonly &lt;SNMP Manager IP Address&gt; &lt;SNMP COMMUNITY STRING&gt;
com2sec -Cn ctx_baicells readonly &lt;SNMP Manager IP Address&gt; enodeb
group readonlygroup v2c readonly
view all included .1
access readonlygroup &quot;&quot; v2c noauth exact all none none
access readonlygroup ctx_baicells v2c noauth prefix all none none
proxy -Cn ctx_baicells -v 2c -c private 192.168.151.1 .1.3
</code></pre>
<p>This configuration allows us to access SNMP data on the EPC with the standard community string (refer to internal standards documentation). but will proxy the Baicells SNMP data when we send the community string ‘enodeb’</p>
<ul>
<li>Update the snmpd service file to automatically restart snmpd on crash:</li>
<li>Edit /lib/systemd/system/snmpd.service, modify the 'ExecStart' line, and add the 'ExecReload', 'Restart', and 'RestartSec' lines:</li>
</ul>
<pre><code>[Unit]
Description=Simple Network Management Protocol (SNMP) Daemon.
After=network.target
ConditionPathExists=/etc/snmp/snmpd.conf

[Service]
Type=simple
ExecStartPre=/bin/mkdir -p /var/run/agentx
ExecStart=/usr/sbin/snmpd -LO2w -u Debian-snmp -g Debian-snmp -I -smux,mteTrigger,mteTriggerConf -f -p /run/snmpd.pid
ExecReload=/bin/kill -HUP $MAINPID
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target
</code></pre>
<ul>
<li>Enable and restart snmpd:</li>
</ul>
<pre><code>Sudo systemctl daemon-reload
sudo systemctl enable snmpd
sudo systemctl restart snmpd
</code></pre>
<h2 id="baicells-snmp-configuration">Baicells SNMP configuration</h2>
<ul>
<li>
<p>Log into the Baicells configuration console:
<code>https://&lt;Baicells IP Address&gt;</code></p>
</li>
<li>
<p>From the left menu, select System</p>
</li>
<li>
<p>Select SNMP
<img alt="Example Screenshot: enabling SNMP in the Baicells Console" src="https://i.imgur.com/YanPtMs.png" /></p>
</li>
<li>Under ‘SNMP Switch,’ select ‘Enable’</li>
<li>Configure the following options:<ul>
<li>Community String: private</li>
<li>Contact: lcl@seattlecommunitynetwork.org</li>
<li>Location: \&lt;SITE NAME STRING&gt; (String should not have any spaces)</li>
<li>Source: Any</li>
</ul>
</li>
</ul>
<h2 id="adding-the-node-to-librenms">Adding the Node to LibreNMS</h2>
<ul>
<li>
<p>If the ePC is running, librenms should be able to auto-discover it. Run this command from a shell on the management host:
<code>sudo -u librenms lnms scan</code></p>
</li>
<li>
<p>LibreNMS should print a status message that it was able to add a new device.</p>
</li>
<li>
<p>When first discovered, the ePC will show up generically as it’s ip address. Edit the hostname, but clicking ‘Edit Device’ (gear icon):</p>
</li>
<li>Click the red pencil icon, and change the ip address to the hostname</li>
<li>
<p>Fill ‘Overwrite IP’ with the ePC IP address</p>
<ul>
<li><em>Note: If the IP is not changed to the hostname, you will not be able to add the eNodeB by it’s IP address</em>
<img alt="Example Screenshot: Updating ePC Hostname in LibreNMS" src="https://i.imgur.com/LHeL3Zq.png" /></li>
</ul>
</li>
<li>
<p>The Baicells eNB needs to be added manually: From LibreNMS, select Devices and click “Add Device”
<img alt="Example Screenshot: Manually adding eNodeB to LibreNMS" src="https://i.imgur.com/Tlqpbh3.png" /></p>
</li>
<li>
<p>Add a new device, with the following configurations:</p>
</li>
<li>Hostname: <IP Address of the site’s EPC></li>
<li>Community: ‘enodeb’</li>
<li>
<p>Force Add: On</p>
</li>
<li>
<p><em>Note: If you receive an error message stating that a device with the specified IP already exists, make sure that you have</em> successfully changed the eNodeB’s hostname per the previous step.</p>
</li>
<li>
<p>Once the device is added, click the ‘Edit Device’ icon (gear icon) and update the following values:</p>
</li>
<li>Display name: \&lt;eNB Cell Name&gt;</li>
<li>Overwrite device contact: lcl@seattlecommunitynetwork.org</li>
</ul>
<h2 id="other-helpful-notes">Other helpful notes:</h2>
<ul>
<li>
<p><a href="https://img.baicells.com//Upload/20210810/FILE/195c7e84-47d9-4acb-aa00-cba0e080d885.pdf">Baicells eNB config guide</a></p>
</li>
<li>
<p>How to SSH into Baicells eNB:</p>
</li>
<li>SSH using port 27149 (username same as normal web-based login)</li>
<li>Convert the MAC address of this eNB to link local address: http://www.sput.nl/internet/ipv6/ll-mac.html</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../librenms-manager-setup/" class="btn btn-neutral float-left" title="Network Monitoring 1. LibreNMS Network Manager Configuration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../epc-setup/" class="btn btn-neutral float-right" title="Step 1. LTE Core Network Setup">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../librenms-manager-setup/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../epc-setup/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
