<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Upgrading - Seattle Community Network Docs</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Upgrading";
        var mkdocs_page_input_path = "infrastructure/librenms/upgrade.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Seattle Community Network Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Faq</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../faq/connection/">How do I get Internet?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../faq/what/">What is a Community Network?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../faq/why/">Why have a Community Network?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../faq/about/">What is the Seattle Community Network?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../faq/how/">How does SCN Work?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../faq/site/">What is this site?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../faq/help/">How can I Help?</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Community</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../community/join/">Join Us</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../community/mission-vision-values/">Mission, Vision, Values</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../community/code-of-conduct/">Code of Conduct</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../community/join/">Join Us</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../community/partners/">Our Partners</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../community/tech-help/">Community Tech Help</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../community/community-networking-toolkit/">Community Networking Toolkit</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Learn</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../learn/wireless-communication/">Wireless Communication</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../learn/cable-crimping/">Crimping Ethernet Cables</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../learn/lte-networks/">LTE Networks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../learn/networking/">Networking</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Infrastructure</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../hardware/">Hardware Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../software/">Software Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../peering/">Public ASN Peering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../librenms-manager-setup/">Network Monitoring 1. LibreNMS Network Manager Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../librenms-setup/">Network Monitoring 2. LibreNMS Agent Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../epc-setup/">Step 1. LTE Core Network Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sas-setup/">Step 2. eNodeB and SAS Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../proxmox-vaultwarden-deployment/">Proxmox Deployment Guide - Vaultwarden</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Librenms</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../deploy/">Deploying</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Upgrading</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#os">OS</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#service">Service</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../backup/">Backing Up</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Contribute</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../contribute/contribute/">Contribute to SCN Docs</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Seattle Community Network Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Infrastructure</li>
          <li class="breadcrumb-item">Librenms</li>
      <li class="breadcrumb-item active">Upgrading</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="upgrading">Upgrading</h1>
<p>Upgrading can be segmented into 2 parts. The container OSses and the service</p>
<h2 id="os">OS</h2>
<p>Each container runs an OS
- The Maria db container is based on ubuntu, so you can just do <code>sudo apt update</code> and <code>sudo apt upgrade</code> when executing bash on the container
- The Redis container for some reason only has an ash executable installed on the container. Also it runs on alpine so it can be updated using <code>apk update</code> and <code>apk upgrade</code>
- The libreNMS and the libreNMS dispatcher container is instantiaated on the same container which is on alpine, and uses bash. Update as usual for alpine installs.</p>
<h2 id="service">Service</h2>
<p>I think that libreNMS vends a script called daily.sh (librenms docs <a href="https://docs.librenms.org/General/Updating/">here</a>) that is added to the cron, but cron is not running on docker containers since each container only runs one process. Even if we manually run daily.sh, there are errors. I think that the docs also give a manually manual way to update, by doing a git clone, but since the librenms files were not pulled using git, we cant use this way. I tried using rsync to overwrite the old files with the new files, but there are some issues. The nuclear option can be used, which is remove the containers, build new updated ones, and start that, but this will include a small outage</p>
<ol>
<li>Go to the compose directory and run <code>sudo docker compose down</code> to stop and remove all the containers. We store data (rrd files and the database) in a docker volume inside the compose directory anyway so we should not need to worry about removing containers removing any data</li>
<li>Go to the <code>librenms_image</code> directory, change the version of the image to the latest version <a href="https://hub.docker.com/r/librenms/librenms/tags">here</a></li>
<li>run <code>sudo docker build . -t scn-librenms</code>, which should build the new image</li>
<li>go to the <code>db_image</code> directory and update the Dockerfile's version to the latest version <a href="https://hub.docker.com/_/mariadb/tags">here</a></li>
<li>run <code>sudo docker build . -t scn_mariadb_librenms</code></li>
<li>go to the compose directory and update the compose.yml file to use the latest redis release <a href="https://hub.docker.com/_/redis/tags">here</a></li>
<li>Then you should be able to start the service with a <code>sudo docker compose -f compose/compose.yml up -d</code></li>
<li>The service should come up as it was before. If it does not, you may have to do a <a href="https://docs.librenms.org/General/Updating/">./lnms migrate</a></li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../deploy/" class="btn btn-neutral float-left" title="Deploying"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../backup/" class="btn btn-neutral float-right" title="Backing Up">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../deploy/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../backup/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
